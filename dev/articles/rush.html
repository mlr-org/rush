<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>rush - Asynchronous and Distributed Computing • rush</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Roboto-0.4.10/font.css" rel="stylesheet">
<link href="../deps/JetBrains_Mono-0.4.10/font.css" rel="stylesheet">
<link href="../deps/Roboto_Slab-0.4.10/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="rush_files/libs/quarto-html/popper.min.js"></script><script src="rush_files/libs/quarto-html/tippy.umd.min.js"></script><link href="rush_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="rush_files/libs/quarto-html/light-border.css" rel="stylesheet">
<!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="rush - Asynchronous and Distributed Computing">
<meta name="robots" content="noindex">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">rush</a>

    <small class="nav-text text-default me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.2.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/rush.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html"><span class="fa fa-file-alt"></span> Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://mlr3book.mlr-org.com"><span class="fa fa-link"></span> mlr3book</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/controller.html">Controller</a></li>
    <li><a class="dropdown-item" href="../articles/error_handling.html">Error Handling and Debugging</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mlr-org/rush/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://lmmisld-lmu-stats-slds.srv.mwn.de/mlr_invite/" aria-label="Mattermost"><span class="fa fa-comments"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://stackoverflow.com/questions/tagged/mlr" aria-label="Stack Overflow"><span class="fa fab fa-stack-overflow"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://mlr-org.com/" aria-label="mlr-org"><span class="fa fa-rss"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-quarto">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>rush - Asynchronous and Distributed Computing</h1>




      <small class="dont-index">Source: <a href="https://github.com/mlr-org/rush/blob/main/vignettes/rush.qmd" class="external-link"><code>vignettes/rush.qmd</code></a></small>
      <div class="d-none name"><code></code></div>
    </div>






    <p><em>rush</em> is a package designed to solve large-scale problems asynchronously across a distributed network. Employing a database centric model, rush enables workers to communicate tasks and their results over a shared <a href="https://redis.io/" class="external-link"><code>Redis</code></a> database. This article demonstrates how to use <code>rush</code> with 3 different examples.</p>
<section class="section level2"><h2 id="random-search">Random Search<a class="anchor" aria-label="anchor" href="#random-search"></a>
</h2>
<p>We begin with a simple random search to optimize the Branin function in parallel. Although random search does not require communication between workers, it is a good way to introduce the basic ideas behind <code>rush</code>. The classic Branin function (also called the Branin-Hoo function) is a well-known benchmark problem in global optimization. It is a two-dimensional function that is non-convex, multimodal, and has three global minima. The function is a toy example for optimization thats fast to evaluate but not too simple to be solved.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">branin</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x1</span>, <span class="va">x2</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="op">(</span><span class="va">x2</span> <span class="op">-</span> <span class="fl">5.1</span> <span class="op">/</span> <span class="op">(</span><span class="fl">4</span> <span class="op">*</span> <span class="va">pi</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">*</span> <span class="va">x1</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="fl">5</span> <span class="op">/</span> <span class="va">pi</span> <span class="op">*</span> <span class="va">x1</span> <span class="op">-</span> <span class="fl">6</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="fl">10</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="fl">8</span> <span class="op">*</span> <span class="va">pi</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">cos</a></span><span class="op">(</span><span class="va">x1</span><span class="op">)</span> <span class="op">+</span> <span class="fl">10</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<p>The Branin function is usually evaluated on the domain <span class="math inline">\(x_1 \in [-5, 10]\)</span> and <span class="math inline">\(x_2 \in [0, 15]\)</span>.</p>
<p><img src="branin.png"></p>
<section class="level2"><h3 id="worker-loop">Worker Loop<a class="anchor" aria-label="anchor" href="#worker-loop"></a>
</h3>
<p>We define the <code>worker_loop</code> function, which runs on each worker. It repeatedly draws tasks, evaluates them, and sends the results to the Redis database. The function takes a single argument: a <code>RushWorker</code> object, which handles communication with Redis. In this example, each worker samples a random point, creates a task, evaluates it using the Branin function, and submits the result. The optimization stops after 100 tasks have been evaluated.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wl_random_search</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">rush</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="kw">while</span><span class="op">(</span><span class="va">rush</span><span class="op">$</span><span class="va">n_finished_tasks</span> <span class="op">&lt;</span> <span class="fl">100</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>    <span class="va">xs</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>x1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">5</span>, <span class="fl">10</span><span class="op">)</span>, x2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">15</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">key</span> <span class="op">=</span> <span class="va">rush</span><span class="op">$</span><span class="fu">push_running_tasks</span><span class="op">(</span>xss <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">xs</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">ys</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu">branin</span><span class="op">(</span><span class="va">xs</span><span class="op">$</span><span class="va">x1</span>, <span class="va">xs</span><span class="op">$</span><span class="va">x2</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">rush</span><span class="op">$</span><span class="fu">push_results</span><span class="op">(</span><span class="va">key</span>, yss <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">ys</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<p>The most important methods of the <code>RushWorker</code> are the <code>$push_running_tasks()</code> and <code>$push_results()</code> methods. The first method <code>$push_running_tasks()</code> creates a new task in the Redis database. Since it is evaluated next, the task is marked as running. The <code>$push_running_tasks()</code> method returns a unique key that is used to identify the task. The second method <code>$push_results()</code> is used to push the results back to the Redis database. It takes the key of the task and a list of results. To mark the task as running is not important for a random search, but it is crucial for more sophisticated algorithms that use the tasks of other workers to decide which task to evaluate next. For example, Bayesian optimization algorithms would sample the next point further away from the previous points to explore the search space. The <code>$n_finished_tasks</code> shows how many tasks are finished and is used to stop the worker loop.</p>
</section><section class="level2"><h3 id="tasks">Tasks<a class="anchor" aria-label="anchor" href="#tasks"></a>
</h3>
<p>Tasks are the unit in which workers exchange information. The main components of a task are the key, computational state, input (<code>xs</code>), and result (<code>ys</code>). The key is a unique identifier for the task. It identifies the task in the Redis database. The four possible computational states are <code>"running"</code>, <code>"finished"</code>, <code>"failed"</code>, and <code>"queued"</code>. The <code>$push_running_tasks()</code> method marks it as <code>"running"</code> and returns the key of the task. The <code>$push_results()</code> method marks a task as <code>"finished"</code> and stores the result. Failed tasks can be marked as <code>"failed"</code> with the <code>$push_failed()</code> method. The error catching must be implemented in the worker loop (see <a href="error_handling.html">Error Handling</a> for more details). Tasks can also be pushed to a queue with the <code>$push_tasks()</code> method which sets the state to <code>"queued"</code>. The last example gives more details on the task queue and the different methods to push and pop tasks. The input <code>xs</code> and result <code>ys</code> are lists that can contain arbitrary data. Usually the methods of the <code>RushWorker</code> work on multiple tasks at once, so <code>xxs</code> and <code>yss</code> are lists of inputs and results.</p>
</section><section class="level2"><h3 id="controller">Controller<a class="anchor" aria-label="anchor" href="#controller"></a>
</h3>
<p>The Rush controller is responsible for starting, observing, and stopping workers within the network. It is initialized using the <code><a href="../reference/rsh.html">rsh()</a></code> function, which requires a network ID and a config argument. The config argument is a configuration file used to connect to the Redis database via the <code>redux</code> package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rush.mlr-org.com">rush</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">config</span> <span class="op">=</span> <span class="fu">redux</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/redux/man/redis_config.html" class="external-link">redis_config</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rush</span> <span class="op">=</span> <span class="fu"><a href="../reference/rsh.html">rsh</a></span><span class="op">(</span></span>
<span>  network <span class="op">=</span> <span class="st">"test-random-search"</span>,</span>
<span>  config <span class="op">=</span> <span class="va">config</span><span class="op">)</span></span></code></pre></div>
</div>
<p>Workers can be started using the <code>$start_local_workers()</code> method, which accepts the worker loop and the number of workers as arguments. The workers are started locally with the <code>processx</code> package but it is also possible to start workers on a remote machine (see <a href="rush_controller.html">Rush Controller</a>). We need to export the <code>branin</code> function to the workers, so we set the <code>globals</code> argument to <code>"branin"</code>. More on globals and the different worker types can be found in the <a href="rush_controller.html">Rush Controller</a> vignette.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rush</span><span class="op">$</span><span class="fu">start_local_workers</span><span class="op">(</span></span>
<span>  worker_loop <span class="op">=</span> <span class="va">wl_random_search</span>,</span>
<span>  n_workers <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  globals <span class="op">=</span> <span class="st">"branin"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rush</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Rush&gt;
* Running Workers: 0
* Queued Tasks: 0
* Queued Priority Tasks: 0
* Running Tasks: 0
* Finished Tasks: 0
* Failed Tasks: 0</code></pre>
</div>
</div>
<p>The optimization is quickly finished and we retrieve the results. The <code>$fetch_finished_tasks()</code> method fetches all finished tasks from the database. The method returns a <code>data.table()</code> with the key, input, and result. The <code>pid</code> and <code>worker_id</code> column are additional information that are stored when the task is created. The <code>worker_id</code> is the id of the worker that evaluated the task and the <code>pid</code> is the process id of that worker. Further extra information can be passed as <code>list</code>s to the <code>$push_running_tasks()</code> and <code>$push_results()</code> methods via the <code>extra</code> argument.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rush</span><span class="op">$</span><span class="fu">fetch_finished_tasks</span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              x1         x2          y   pid     worker_id          keys
           &lt;num&gt;      &lt;num&gt;      &lt;num&gt; &lt;int&gt;        &lt;char&gt;        &lt;char&gt;
  1: -2.99758993 10.8615673   1.642256 10244 unfleshly_... 2bfb7fbe-c...
  2:  3.21136281  3.4302073   1.882904 10260 authoritat... 33c24b0d-2...
  3: -2.90313550 10.3046163   2.642662 10244 unfleshly_... af9f7dba-3...
  4: -3.06023456 10.5723062   2.703791 10255 smooth_aou... 51396f45-1...
  5:  8.70398943  2.1760046   2.844582 10255 smooth_aou... acf75bbe-8...
  6:  9.77055124  1.3517598   3.012110 10270 costeffect... ddf23525-2...
  7: -2.34327773  9.6170992   3.973719 10270 costeffect... c890a47c-d...
  8:  2.42569305  1.4973363   4.721266 10244 unfleshly_... d215abc6-0...
  9: -3.56233302 10.7466504   7.800997 10270 costeffect... 45574004-6...
 10: -4.33507339 14.0961912   7.977787 10244 unfleshly_... adb46351-c...
 11: -1.67054551  8.3041919   9.555127 10260 authoritat... 9025364b-e...
 12:  8.03193136  2.9122611  10.154091 10244 unfleshly_... 4ade38bb-e...
 13:  7.75463124  1.6262840  10.992302 10244 unfleshly_... 3caa391c-9...
 14:  2.61306900  5.7932066  11.132643 10244 unfleshly_... 5ebd02b1-e...
 15:  4.43452742  3.4815766  11.361857 10244 unfleshly_... 42b69a73-3...
 16: -3.11849915  8.8079684  12.039471 10255 smooth_aou... bb6558ab-f...
 17:  1.68076915  5.6566319  12.814123 10255 smooth_aou... 519daf91-0...
 18:  1.74019969  1.4381336  13.148642 10244 unfleshly_... 43f71dee-d...
 19:  5.01400446  1.9581673  13.329188 10260 authoritat... 59bfabb2-6...
 20: -4.06824899 11.5575955  13.568754 10244 unfleshly_... 66c46598-2...
 21: -3.72993896 10.3270643  13.617248 10260 authoritat... a0970204-4...
 22:  2.34265435  6.3059378  14.361250 10244 unfleshly_... 01651e96-d...
 23:  7.83756264  3.6379760  14.894268 10255 smooth_aou... b00d24fc-5...
 24:  5.01563947  2.7255867  14.994284 10244 unfleshly_... b6c4fa97-4...
 25:  3.74491815  5.5562898  15.818469 10244 unfleshly_... 149a0700-9...
 26:  5.75470473  0.8109837  18.387170 10260 authoritat... 9041af2c-9...
 27:  3.80707789  5.8635541  18.851960 10260 authoritat... 275dfb78-d...
 28:  0.40717006  4.8526026  19.088309 10255 smooth_aou... e87bb8d5-5...
 29:  1.31493654  1.5387991  19.147410 10244 unfleshly_... 4d5d9f5f-1...
 30:  5.78656061  1.9939500  19.212839 10270 costeffect... d334989e-0...
 31:  5.68875923  2.3255985  19.392360 10244 unfleshly_... 4f31d7c2-a...
 32: -0.18575537  6.7000193  19.596866 10244 unfleshly_... 34450680-f...
 33:  0.28126608  6.3480693  19.841803 10270 costeffect... 21353aab-5...
 34:  0.20858279  4.4938021  20.786033 10244 unfleshly_... 924c0641-f...
 35: -0.62579458  5.2435239  21.033483 10244 unfleshly_... 55932e9d-5...
 36:  0.80349743  2.6895371  21.139202 10255 smooth_aou... 0354094b-0...
 37:  8.48683117  5.9568749  21.621518 10255 smooth_aou... 6ffc1ff2-c...
 38: -4.95090340 13.9348176  21.948707 10255 smooth_aou... 32c46eb9-d...
 39:  8.30887598  5.9201391  23.636508 10255 smooth_aou... f43cfdd7-0...
 40:  6.52097747  3.2139317  23.737957 10260 authoritat... 67a327d3-8...
 41:  4.33448630  5.7345096  24.147271 10244 unfleshly_... b8a30f10-7...
 42:  4.15667443  6.0301689  24.414965 10255 smooth_aou... 1564fa14-a...
 43: -0.83479335 10.3550383  25.068624 10270 costeffect... 02e3c0df-8...
 44: -0.07584127  8.6429173  25.932317 10270 costeffect... 8f81502f-9...
 45:  5.75941912  3.9318395  26.228245 10270 costeffect... da476632-5...
 46: -1.14407797 11.5074725  26.347154 10255 smooth_aou... b5f92097-a...
 47: -0.63374656  4.1094099  26.446596 10244 unfleshly_... 216f209a-5...
 48: -2.02108889 14.4036766  27.530153 10244 unfleshly_... 432a2de7-7...
 49:  3.59989710  7.0739550  27.697825 10255 smooth_aou... 302b824b-5...
 50: -1.14592011 11.9920341  29.946943 10244 unfleshly_... a91e18d2-c...
 51:  1.52349762  8.4523245  31.404787 10255 smooth_aou... c2fe9378-0...
 52:  4.90447039  5.7502575  31.622951 10270 costeffect... 135f85bb-d...
 53: -1.26741824  3.7851662  32.577821 10270 costeffect... 598d830c-e...
 54:  5.04628828  5.7707021  33.508942 10260 authoritat... 28c480da-4...
 55:  1.06365004  8.8364170  33.875301 10255 smooth_aou... 83163eff-6...
 56:  0.84319254  9.1466462  35.717886 10255 smooth_aou... fbab2c74-6...
 57: -0.85745413  2.9741649  36.402956 10244 unfleshly_... 22372a8b-9...
 58: -3.83364463  8.1569290  36.748887 10260 authoritat... 534f5c99-1...
 59:  0.06123197  1.6481562  37.688074 10244 unfleshly_... 20be084b-b...
 60:  5.94236279  5.4547363  37.977336 10255 smooth_aou... bee13198-9...
 61:  9.16167100  8.3718935  38.059048 10270 costeffect... b37902e9-4...
 62:  5.59173836  5.7082636  38.268024 10260 authoritat... 189b339c-4...
 63: -1.02909817  2.5760465  41.976483 10244 unfleshly_... 0f1b2e8e-4...
 64: -2.27399489  3.9716593  43.676684 10244 unfleshly_... e8f7eb22-e...
 65: -0.75434159 12.5488184  44.820121 10244 unfleshly_... 350ead4b-a...
 66:  5.50837789  6.4505165  44.926091 10244 unfleshly_... da729163-6...
 67:  6.14766377  6.1644932  45.182828 10255 smooth_aou... e5ad5c29-f...
 68: -0.21389141  0.9709672  48.277816 10255 smooth_aou... 3443249f-a...
 69:  7.03239091  6.8440957  48.927871 10260 authoritat... 03a00a35-3...
 70: -2.21518671  3.4513049  49.231709 10244 unfleshly_... f687e701-a...
 71:  5.52750319  6.8808727  49.834596 10255 smooth_aou... e6fc6558-3...
 72:  5.74855949  7.0057085  52.904893 10260 authoritat... 6d5c3a50-b...
 73:  9.07076072  9.5659764  55.360467 10260 authoritat... 4828dfd8-a...
 74: -3.93765243  6.9232259  57.257969 10255 smooth_aou... 359a24c3-4...
 75:  7.40815841  8.2806761  62.880046 10270 costeffect... 0c86c71a-4...
 76: -1.20824031  0.7042468  68.273877 10260 authoritat... 25783daa-9...
 77:  0.58092173 12.2853501  69.383096 10270 costeffect... 87379441-4...
 78:  9.84241527 11.3275492  73.095111 10260 authoritat... 95c31b2b-c...
 79:  7.35683395  9.0666640  75.163483 10260 authoritat... 523a1598-4...
 80:  4.61784965  9.7737686  79.125449 10260 authoritat... 015698e6-e...
 81: -4.08173474  5.9695060  79.664020 10244 unfleshly_... a3860269-b...
 82:  0.88474061 12.7114657  80.378430 10244 unfleshly_... 772f41f6-2...
 83:  6.00621270  9.3304634  86.958676 10255 smooth_aou... 04ad7dcc-c...
 84: -3.22444810  3.0967869  88.381866 10244 unfleshly_... 7523fa13-a...
 85: -3.51793187  3.5172088  94.782367 10244 unfleshly_... aba2ccbd-8...
 86:  8.47082269 11.4032122  96.900157 10255 smooth_aou... 18cc308b-8...
 87:  4.22051214 11.3138159 100.134924 10260 authoritat... 1e373036-a...
 88:  4.94330120 10.6893535 100.559093 10255 smooth_aou... d81b5441-e...
 89: -4.61828875  6.0979494 109.250009 10244 unfleshly_... e54b55dc-f...
 90:  1.96602305 13.7014112 113.034730 10260 authoritat... d3e0f785-3...
 91:  6.21921297 10.8468411 114.612773 10244 unfleshly_... 8c7328ee-9...
 92:  6.89364923 11.3275863 121.093643 10270 costeffect... cd8b7548-f...
 93:  3.75598932 13.2820450 132.968551 10244 unfleshly_... 45acdc2b-a...
 94:  9.76138880 14.5258097 139.051764 10255 smooth_aou... 2330b0ce-4...
 95: -3.51215324  1.4108276 139.640387 10244 unfleshly_... ee9db236-b...
 96:  3.99522662 13.5856517 144.876424 10260 authoritat... c97a8ae1-b...
 97: -4.60818890  3.7528216 160.897629 10244 unfleshly_... 770ce8af-4...
 98:  8.86024650 14.9768347 169.250062 10260 authoritat... 86472045-a...
 99:  4.10053298 14.6967475 174.807842 10270 costeffect... ef27e0f6-a...
100:  8.02731359 14.6688749 180.488352 10270 costeffect... ced976f5-c...
              x1         x2          y   pid     worker_id          keys</code></pre>
</div>
</div>
<p>The rush controller displays how many workers are running and how many tasks exist in each state. In this case, 103 tasks are marked as finished, and all workers have stopped. The number slightly exceeds 100 because workers check the stopping condition independently. If several workers evaluate the condition around the same time — when, for example, 99 tasks are finished — they may all create new tasks before detecting that the limit has been reached. Additionally, tasks may continue to be created while the 100th task is still being evaluated.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rush</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Rush&gt;
* Running Workers: 0
* Queued Tasks: 0
* Queued Priority Tasks: 0
* Running Tasks: 0
* Finished Tasks: 100
* Failed Tasks: 0</code></pre>
</div>
</div>
<p>We can stop the workers and reset the database with the <code>$reset()</code> method.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rush</span><span class="op">$</span><span class="fu">reset</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rush</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Rush&gt;
* Running Workers: 0
* Queued Tasks: 0
* Queued Priority Tasks: 0
* Running Tasks: 0
* Finished Tasks: 0
* Failed Tasks: 0</code></pre>
</div>
</div>
<p>To learn more about starting, stopping and observing workers, see the <a href="rush_controller.html">Rush Controller</a> vignette.</p>
</section></section><section class="section level2"><h2 id="median-stopping">Median Stopping<a class="anchor" aria-label="anchor" href="#median-stopping"></a>
</h2>
<p>Random search is a simple example that doesn’t rely on information from previous tasks and therefore doesn’t require communication between workers. Now, let’s implement a more sophisticated algorithm that uses the results of completed tasks to decide whether to continue evaluating the current one. We tune an XGBoost model on the mtcars dataset and use the median stopping rule to stop the training early.</p>
<section class="level2"><h3 id="worker-loop-1">Worker Loop<a class="anchor" aria-label="anchor" href="#worker-loop-1"></a>
</h3>
<p>The worker starts by sampling a random hyperparameter configuration with three parameters: maximum tree depth, lambda regularization, and alpha regularization. These parameters control how the XGBoost model learns from the data. The worker then trains the model incrementally, starting with 5 boosting rounds and adding one round at a time up to 20 rounds. After each round, the worker evaluates the model’s performance on a test set using root mean squared error (RMSE). At this point, the worker checks how well its model is doing compared to other workers by fetching their completed results and comparing its performance to the median score among all models with the same number of training rounds.</p>
<p>If the current model performs worse than the median, the worker stops this hyperparameter configuration and starts over with a new one. This early stopping mechanism prevents workers from wasting time on poor-performing configurations. If the model performs at or above the median, the worker continues training for one more round. The process continues until the network has evaluated 1000 complete models across all workers.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wl_median_stopping</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">rush</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">while</span><span class="op">(</span><span class="va">rush</span><span class="op">$</span><span class="va">n_finished_tasks</span> <span class="op">&lt;</span> <span class="fl">1000</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>    <span class="va">params</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      max_depth <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>      lambda <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>      alpha <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span>    <span class="va">model</span> <span class="op">=</span> <span class="cn">NULL</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">iteration</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">20</span>, by <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>      <span class="va">key</span> <span class="op">=</span> <span class="va">rush</span><span class="op">$</span><span class="fu">push_running_tasks</span><span class="op">(</span>xss <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">params</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>nrounds <span class="op">=</span> <span class="va">iteration</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>      <span class="va">model</span> <span class="op">=</span> <span class="fu">xgboost</span><span class="op">(</span></span>
<span>        data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span><span class="va">training_ids</span>, <span class="op">]</span><span class="op">)</span>,</span>
<span>        label <span class="op">=</span> <span class="va">y</span><span class="op">[</span><span class="va">training_ids</span><span class="op">]</span>,</span>
<span>        nrounds <span class="op">=</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span><span class="op">)</span> <span class="fl">5</span> <span class="kw">else</span> <span class="fl">1</span>,</span>
<span>        params <span class="op">=</span> <span class="va">params</span>,</span>
<span>        xgb_model <span class="op">=</span> <span class="va">model</span>,</span>
<span>        verbose <span class="op">=</span> <span class="fl">0</span></span>
<span>      <span class="op">)</span></span>
<span></span>
<span>      <span class="va">pred</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">model</span>, <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span><span class="va">test_ids</span>, <span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="va">rmse</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="op">(</span><span class="va">pred</span> <span class="op">-</span> <span class="va">y</span><span class="op">[</span><span class="va">test_ids</span><span class="op">]</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>      <span class="va">rush</span><span class="op">$</span><span class="fu">push_results</span><span class="op">(</span><span class="va">key</span>, yss <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>rmse <span class="op">=</span> <span class="va">rmse</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>      <span class="va">tasks</span> <span class="op">=</span> <span class="va">rush</span><span class="op">$</span><span class="fu">fetch_finished_tasks</span><span class="op">(</span><span class="op">)</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="va">rmse</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">tasks</span><span class="op">[</span><span class="va">nrounds</span> <span class="op">==</span> <span class="va">iteration</span>, <span class="va">rmse</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="kw">break</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<p>The worker loop uses a new method called <code>$fetch_finished_tasks()</code> to fetch all finished tasks from the database. Other methods like <code>$fetch_running_tasks()</code> and <code>$fetch_failed_tasks()</code> are also available.</p>
<p>We sample a training and test set from the mtcars dataset. The training set is used to fit the model and the test set is used to evaluate the model. Then we initialize the rush network and start the workers. This time we have to pass the training and test set to the workers via the <code>globals</code> argument and the <code>packages</code> argument to load the <code>data.table</code> and <code>xgboost</code> packages.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span></span>
<span></span>
<span><span class="va">training_ids</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span>, <span class="fl">20</span><span class="op">)</span></span>
<span><span class="va">test_ids</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span>, <span class="va">training_ids</span><span class="op">)</span></span>
<span><span class="va">data</span> <span class="op">=</span> <span class="va">mtcars</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">y</span> <span class="op">=</span> <span class="va">mtcars</span><span class="op">$</span><span class="va">mpg</span></span>
<span></span>
<span><span class="va">config</span> <span class="op">=</span> <span class="fu">redux</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/redux/man/redis_config.html" class="external-link">redis_config</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rush</span> <span class="op">=</span> <span class="fu"><a href="../reference/rsh.html">rsh</a></span><span class="op">(</span></span>
<span>  network <span class="op">=</span> <span class="st">"test-median-stopping"</span>,</span>
<span>  config <span class="op">=</span> <span class="va">config</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rush</span><span class="op">$</span><span class="fu">start_local_workers</span><span class="op">(</span></span>
<span>  worker_loop <span class="op">=</span> <span class="va">wl_median_stopping</span>,</span>
<span>  n_workers <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  packages <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"data.table"</span>, <span class="st">"xgboost"</span><span class="op">)</span>,</span>
<span>  globals <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"training_ids"</span>, <span class="st">"test_ids"</span>, <span class="st">"data"</span>, <span class="st">"y"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<p>We fetch the finished tasks and sort them by the objective value.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rush</span><span class="op">$</span><span class="fu">fetch_finished_tasks</span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Null data.table (0 rows and 0 cols)</code></pre>
</div>
</div>
<p>We stop the workers and reset the database.ch</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rush</span><span class="op">$</span><span class="fu">reset</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
</section></section><section class="section level2"><h2 id="bayesian-optimization">Bayesian Optimization<a class="anchor" aria-label="anchor" href="#bayesian-optimization"></a>
</h2>
<p>We implement Asynchronous Distributed Bayesian Optimization (ADBO) <span class="citation" data-cites="egele_2023">[@egele_2023]</span> next. This example shows how workers use information about running tasks and introduces task queues. ADBO runs sequential <a href="https://mlr3book.mlr-org.com/chapters/chapter5/advanced_tuning_methods_and_black_box_optimization.html#sec-bayesian-optimization" class="external-link">Bayesian optimization</a> on multiple workers in parallel. Each worker maintains its own surrogate model (a random forest) and selects the next hyperparameter configuration by maximizing the upper confidence bounds acquisition function. To promote a varying exploration-exploitation tradeoff between the workers, the acquisition functions are initialized with different lambda values ranging from 0.1 to 10. When a worker completes an evaluation, it asynchronously sends the result to its peers via a Redis data base; each worker then updates its local model with this shared information. This decentralized design enables workers to proceed independently; eliminating the need for a central coordinator that could become a bottleneck in large-scale optimization scenarios.</p>
<p>We first create a new rush network.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">config</span> <span class="op">=</span> <span class="fu">redux</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/redux/man/redis_config.html" class="external-link">redis_config</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rush</span> <span class="op">=</span> <span class="fu"><a href="../reference/rsh.html">rsh</a></span><span class="op">(</span></span>
<span>  network <span class="op">=</span> <span class="st">"test-bayesian-optimization"</span>,</span>
<span>  config <span class="op">=</span> <span class="va">config</span><span class="op">)</span></span></code></pre></div>
</div>
<section class="level2"><h3 id="queues">Queues<a class="anchor" aria-label="anchor" href="#queues"></a>
</h3>
<p>The queue system works by pushing and popping tasks from a queue. The <code>$push_task()</code> method creates new tasks and pushes them to the queue. In this example, we draw an initial design of 25 points and push them to the queue.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">xss</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span><span class="fl">25</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>x1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">5</span>, <span class="fl">10</span><span class="op">)</span>, x2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">15</span><span class="op">)</span><span class="op">)</span>, simplify <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rush</span><span class="op">$</span><span class="fu">push_tasks</span><span class="op">(</span>xss <span class="op">=</span> <span class="va">xss</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rush</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Rush&gt;
* Running Workers: 0
* Queued Tasks: 25
* Queued Priority Tasks: 0
* Running Tasks: 0
* Finished Tasks: 0
* Failed Tasks: 0</code></pre>
</div>
</div>
<p>We see 25 queued tasks in the database. To retrieve the tasks from the queue, we need to implement the <code>$pop_task()</code> method in the worker loop.</p>
</section><section class="level2"><h3 id="worker-loop-2">Worker Loop<a class="anchor" aria-label="anchor" href="#worker-loop-2"></a>
</h3>
<p>The worker loop pops tasks with the <code>$pop_task()</code> method from the queue. The task is evaluated and the results are pushed back to the database with the <code>$push_results()</code> method. If there are no more tasks in the queue, the <code>$pop_task()</code> method returns <code>NULL</code> and the worker loop starts the Bayesian optimization. First, a lambda value for the acquisition function is sampled between 0.01 and 10. Then all running and finished tasks are fetched from the database. Using <code>rush$fetch_tasks_with_state()</code> instead of using <code>$fetch_running_tasks()</code> and <code>$fetch_finished_tasks()</code> is important because it prevents tasks from appearing twice. This could be the case if a worker changes the state of a task from <code>"running"</code> to <code>"finished"</code> while the tasks are being fetched. The missing y values of the running tasks are imputed with the mean of the finished tasks. Then the surrogate random forest model is fitted to the data and the acquisition function is optimized to find the next task. Marking the task as running is important for the Bayesian optimization algorithm, as it uses the already sampled points of the other workers to decide which task to evaluate next. The task is evaluated and the results are pushed back to the database. We stop the optimization process after 100 evaluated tasks.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wl_bayesian_optimization</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">rush</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">repeat</span> <span class="op">{</span></span>
<span>    <span class="va">task</span> <span class="op">=</span> <span class="va">rush</span><span class="op">$</span><span class="fu">pop_task</span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">task</span><span class="op">)</span><span class="op">)</span> <span class="kw">break</span></span>
<span>    <span class="va">ys</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu">branin</span><span class="op">(</span><span class="va">task</span><span class="op">$</span><span class="va">xs</span><span class="op">$</span><span class="va">x1</span>, <span class="va">task</span><span class="op">$</span><span class="va">xs</span><span class="op">$</span><span class="va">x2</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">rush</span><span class="op">$</span><span class="fu">push_results</span><span class="op">(</span><span class="va">task</span><span class="op">$</span><span class="va">key</span>, yss <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">ys</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="va">lambda</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.01</span>, <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw">while</span><span class="op">(</span><span class="va">rush</span><span class="op">$</span><span class="va">n_finished_tasks</span> <span class="op">&lt;</span> <span class="fl">100</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>    <span class="va">xydt</span> <span class="op">=</span> <span class="va">rush</span><span class="op">$</span><span class="fu">fetch_tasks_with_state</span><span class="op">(</span>states <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"running"</span>, <span class="st">"finished"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">mean_y</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">xydt</span><span class="op">$</span><span class="va">y</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    <span class="va">xydt</span><span class="op">[</span><span class="st">"running"</span>, <span class="va">y</span> <span class="op">:=</span> <span class="va">mean_y</span>, on <span class="op">=</span> <span class="st">"state"</span><span class="op">]</span></span>
<span></span>
<span>    <span class="va">surrogate</span> <span class="op">=</span> <span class="fu">ranger</span><span class="fu">::</span><span class="fu">ranger</span><span class="op">(</span></span>
<span>      <span class="va">y</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">+</span> <span class="va">x2</span>,</span>
<span>      data <span class="op">=</span> <span class="va">xydt</span>,</span>
<span>      num.trees <span class="op">=</span> <span class="fl">100L</span>,</span>
<span>      keep.inbag <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    <span class="va">xdt</span> <span class="op">=</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></span><span class="op">(</span>x1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="op">-</span><span class="fl">5</span>, <span class="fl">10</span><span class="op">)</span>, x2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fl">0</span>, <span class="fl">15</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">p</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">surrogate</span>, <span class="va">xdt</span>, type <span class="op">=</span> <span class="st">"se"</span>, se.method <span class="op">=</span> <span class="st">"jack"</span><span class="op">)</span></span>
<span>    <span class="va">cb</span> <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">predictions</span> <span class="op">-</span> <span class="va">lambda</span> <span class="op">*</span> <span class="va">p</span><span class="op">$</span><span class="va">se</span></span>
<span>    <span class="va">xs</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="va">xdt</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html" class="external-link">which.min</a></span><span class="op">(</span><span class="va">cb</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">key</span> <span class="op">=</span> <span class="va">rush</span><span class="op">$</span><span class="fu">push_running_tasks</span><span class="op">(</span>xss <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">xs</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">ys</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu">branin</span><span class="op">(</span><span class="va">xs</span><span class="op">$</span><span class="va">x1</span>, <span class="va">xs</span><span class="op">$</span><span class="va">x2</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">rush</span><span class="op">$</span><span class="fu">push_results</span><span class="op">(</span><span class="va">key</span>, yss <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">ys</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<p>We start the optimization process by starting 4 local workers that run the Bayesian optimization worker loop.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rush</span><span class="op">$</span><span class="fu">start_local_workers</span><span class="op">(</span></span>
<span>  worker_loop <span class="op">=</span> <span class="va">wl_bayesian_optimization</span>,</span>
<span>  n_workers <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  globals <span class="op">=</span> <span class="st">"branin"</span><span class="op">)</span></span></code></pre></div>
</div>
<p>The optimization is quickly finished and we retrieve the results.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rush</span><span class="op">$</span><span class="fu">fetch_finished_tasks</span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           x1         x2          y   pid     worker_id          keys
        &lt;num&gt;      &lt;num&gt;      &lt;num&gt; &lt;int&gt;        &lt;char&gt;        &lt;char&gt;
 1:  2.812057  3.1173944   1.241019 10546 cookable_b... 4f1dae29-a...
 2: -2.872484 12.5045150   1.494983 10546 cookable_b... 2d9d4f3c-9...
 3:  2.473399  1.5347349   4.202767 10546 cookable_b... 2911e246-a...
 4: -3.953300 12.3197846   7.355557 10544 amoebic_in... 45f0205c-4...
 5:  2.220186  5.4652899   9.772860 10556 transplane... c14a7cec-9...
 6:  2.259986  0.5852572  10.032791 10546 cookable_b... 8b76a60d-b...
 7:  2.663319  6.4966206  16.060735 10546 cookable_b... a857a00b-1...
 8:  6.168446  2.5734135  21.715678 10556 transplane... fb9e6a43-e...
 9:  5.111175  4.6577223  25.408354 10556 transplane... 4ab293b2-a...
10:  8.450057  6.4072796  26.062408 10546 cookable_b... 2d0abb25-7...
11: -1.864750  4.5052113  31.344095 10556 transplane... e678cf78-4...
12:  6.338527  5.0986465  35.559339 10546 cookable_b... 66a1aef8-5...
13:  5.257668  7.0862045  49.589727 10556 transplane... 1c95572e-2...
14: -2.184817  2.5844216  60.859886 10546 cookable_b... 82be8b27-7...
15: -1.510688  1.0707188  68.769888 10556 transplane... 78c1a22b-2...
16: -1.274992  0.4182323  73.966880 10556 transplane... 8a089436-b...
17:  9.280140 10.9993431  75.210756 10556 transplane... 452213eb-0...
18:  8.195293 11.0633431  95.713866 10544 amoebic_in... d24e53ac-e...
19:  7.563273 10.5393378  97.151516 10556 transplane... 77e69438-0...
20:  7.838009 10.8364741  98.038029 10546 cookable_b... a41f2f27-2...
21:  6.724347 11.0741913 117.387124 10567 tinted_inv... 4fd9c848-1...
22:  2.441226 14.1585809 129.761841 10546 cookable_b... 81d1ef96-8...
23: -4.278977  3.6529052 138.738194 10546 cookable_b... efa6afa3-7...
24: -4.424341  3.4190177 154.926287 10556 transplane... 2baba98c-6...
25:  6.158260 14.4327082 197.340669 10546 cookable_b... eac69e79-4...
           x1         x2          y   pid     worker_id          keys</code></pre>
</div>
</div>
</section></section><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config);
    }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script></main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Marc Becker.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
