<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Controller • rush</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Roboto-0.4.10/font.css" rel="stylesheet">
<link href="../deps/JetBrains_Mono-0.4.10/font.css" rel="stylesheet">
<link href="../deps/Roboto_Slab-0.4.10/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="controller_files/libs/quarto-html/popper.min.js"></script><script src="controller_files/libs/quarto-html/tippy.umd.min.js"></script><link href="controller_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="controller_files/libs/quarto-html/light-border.css" rel="stylesheet">
<!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Controller">
<meta name="robots" content="noindex">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">rush</a>

    <small class="nav-text text-default me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.4.1.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/rush.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html"><span class="fa fa-file-alt"></span> Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://mlr3book.mlr-org.com"><span class="fa fa-link"></span> mlr3book</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/controller.html">Controller</a></li>
    <li><a class="dropdown-item" href="../articles/error_handling.html">Error Handling and Debugging</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mlr-org/rush/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://lmmisld-lmu-stats-slds.srv.mwn.de/mlr_invite/" aria-label="Mattermost"><span class="fa fa-comments"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://stackoverflow.com/questions/tagged/mlr" aria-label="Stack Overflow"><span class="fa fab fa-stack-overflow"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://mlr-org.com/" aria-label="mlr-org"><span class="fa fa-rss"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-quarto">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Controller</h1>




      <small class="dont-index">Source: <a href="https://github.com/mlr-org/rush/blob/main/vignettes/controller.qmd" class="external-link"><code>vignettes/controller.qmd</code></a></small>
      <div class="d-none name"><code></code></div>
    </div>






    <p>A <strong>rush</strong> network consists of thousands of workers started on different machines. This article explains how to start workers in a rush network. Rush offers three ways to start workers: local workers with <code>processx</code>, remote workers with <code>mirai</code> and script workers.</p>
<section class="section level2"><h2 id="sec-local-workers">Local Workers<a class="anchor" aria-label="anchor" href="#sec-local-workers"></a>
</h2>
<p>We use the random search example from the <a href="rush.html">Rush article</a> to demonstrate how the controller works.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rush.mlr-org.com">rush</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">wl_random_search</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">rush</span>, <span class="va">branin</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">while</span><span class="op">(</span><span class="cn">TRUE</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>    <span class="va">xs</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>x1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">5</span>, <span class="fl">10</span><span class="op">)</span>, x2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">15</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">key</span> <span class="op">=</span> <span class="va">rush</span><span class="op">$</span><span class="fu">push_running_tasks</span><span class="op">(</span>xss <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">xs</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">ys</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu">branin</span><span class="op">(</span><span class="va">xs</span><span class="op">$</span><span class="va">x1</span>, <span class="va">xs</span><span class="op">$</span><span class="va">x2</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">rush</span><span class="op">$</span><span class="fu">push_results</span><span class="op">(</span><span class="va">key</span>, yss <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">ys</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">rush</span> <span class="op">=</span> <span class="fu"><a href="../reference/rsh.html">rsh</a></span><span class="op">(</span></span>
<span>  network <span class="op">=</span> <span class="st">"test-network"</span>,</span>
<span>  config <span class="op">=</span> <span class="fu">redux</span><span class="fu">::</span><span class="fu"><a href="https://richfitz.github.io/redux/reference/redis_config.html" class="external-link">redis_config</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">branin</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x1</span>, <span class="va">x2</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="op">(</span><span class="va">x2</span> <span class="op">-</span> <span class="fl">5.1</span> <span class="op">/</span> <span class="op">(</span><span class="fl">4</span> <span class="op">*</span> <span class="va">pi</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">*</span> <span class="va">x1</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="fl">5</span> <span class="op">/</span> <span class="va">pi</span> <span class="op">*</span> <span class="va">x1</span> <span class="op">-</span> <span class="fl">6</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="fl">10</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="fl">8</span> <span class="op">*</span> <span class="va">pi</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">cos</a></span><span class="op">(</span><span class="va">x1</span><span class="op">)</span> <span class="op">+</span> <span class="fl">10</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<section class="level2"><h3 id="sec-local-start-workers">Start Workers<a class="anchor" aria-label="anchor" href="#sec-local-start-workers"></a>
</h3>
<p>Workers may be initiated locally or remotely. Local workers run on the same machine as the controller, whereas remote workers operate on separate machines. The <code>$start_local_workers()</code> method initiates local workers using the <code>processx</code> package. The <code>n_workers</code> parameter specifies the number of workers to launch. The <code>worker_loop</code> parameter defines the function executed by each worker. If the <code>worker_loop</code> function depends on additional objects, these can be passed as arguments to <code>worker_loop</code>. Required packages for the <code>worker_loop</code> can be specified using the <code>packages</code> parameter.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">worker_ids</span> <span class="op">=</span> <span class="va">rush</span><span class="op">$</span><span class="fu">start_local_workers</span><span class="op">(</span></span>
<span>  worker_loop <span class="op">=</span> <span class="va">wl_random_search</span>,</span>
<span>  branin <span class="op">=</span> <span class="va">branin</span>,</span>
<span>  n_workers <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
</div>
<p>Worker information is accessible through the <code>$worker_info</code> method. Each worker is identified by a <code>worker_id</code>. The <code>pid</code> field denotes the process identifier, and the <code>hostname</code> field indicates the machine name. The <code>remote</code> column specifies whether the worker is remote, and the <code>heartbeat</code> column indicates the presence of a heartbeat process. The <code>state</code> column indicates the current state of the worker. Possible states include <code>"running"</code>, <code>"terminated"</code>, <code>"killed"</code>, and <code>"lost"</code>. Heartbeat mechanisms are discussed in the <a href="#error-handling">Error Handling</a> section.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rush</span><span class="op">$</span><span class="va">worker_info</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       worker_id   pid remote      hostname heartbeat   state
          &lt;char&gt; &lt;int&gt; &lt;lgcl&gt;        &lt;char&gt;    &lt;lgcl&gt;  &lt;char&gt;
1: roomy_clea...  8623  FALSE runnervmwf...     FALSE running
2: presentien...  8634  FALSE runnervmwf...     FALSE running</code></pre>
</div>
</div>
<p>Additional workers may be added to the network at any time.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rush</span><span class="op">$</span><span class="fu">start_local_workers</span><span class="op">(</span></span>
<span>  worker_loop <span class="op">=</span> <span class="va">wl_random_search</span>,</span>
<span>  branin <span class="op">=</span> <span class="va">branin</span>,</span>
<span>  n_workers <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rush</span><span class="op">$</span><span class="va">worker_info</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       worker_id   pid remote      hostname heartbeat   state
          &lt;char&gt; &lt;int&gt; &lt;lgcl&gt;        &lt;char&gt;    &lt;lgcl&gt;  &lt;char&gt;
1: roomy_clea...  8623  FALSE runnervmwf...     FALSE running
2: presentien...  8634  FALSE runnervmwf...     FALSE running
3: endangered...  8697  FALSE runnervmwf...     FALSE running
4: incredulou...  8699  FALSE runnervmwf...     FALSE running</code></pre>
</div>
</div>
</section><section class="level2"><h3 id="sec-local-rush-plan">Rush Plan<a class="anchor" aria-label="anchor" href="#sec-local-rush-plan"></a>
</h3>
<p>When <code>rush</code> is integrated into a third-party package, the starting of workers is typically managed by the package itself. In such cases, users may configure worker options by invoking the <code><a href="../reference/rush_plan.html">rush_plan()</a></code> function. This function allows explicit specification of the number of workers, the type of workers, and the configuration for connecting to the Redis database.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/rush_plan.html">rush_plan</a></span><span class="op">(</span>n_workers <span class="op">=</span> <span class="fl">2</span>, config <span class="op">=</span> <span class="fu">redux</span><span class="fu">::</span><span class="fu"><a href="https://richfitz.github.io/redux/reference/redis_config.html" class="external-link">redis_config</a></span><span class="op">(</span><span class="op">)</span>, worker_type <span class="op">=</span> <span class="st">"local"</span><span class="op">)</span></span></code></pre></div>
</div>
</section><section class="level2"><h3 id="sec-local-globals">Passing data to workers<a class="anchor" aria-label="anchor" href="#sec-local-globals"></a>
</h3>
<p>Objects required by the worker loop can be passed as arguments to <code>$start_local_workers()</code> / <code>$start_remote_workers()</code>. These arguments are serialized and stored in the Redis database as part of the worker configuration. Upon initialization, each worker retrieves and unserializes the worker configuration before invoking the worker loop.</p>
<div>
<blockquote>
<p><strong>Note</strong></p>
<p>The maximum size of a Redis string is 512 MiB. If the serialized worker configuration exceeds this limit, Rush will raise an error. In scenarios where both the controller and the workers have access to a shared file system, Rush will instead write large objects to disk. The <code>large_objects_path</code> argument of <code><a href="../reference/rush_plan.html">rush_plan()</a></code> specifies the directory used for storing such large objects.</p>
</blockquote>
</div>
</section><section class="level2"><h3 id="sec-local-stop-worker">Stop Worker<a class="anchor" aria-label="anchor" href="#sec-local-stop-worker"></a>
</h3>
<p>Workers can be stopped individually or all at once. To terminate a specific worker, the <code>$stop_workers()</code> method is invoked with the corresponding <code>worker_ids</code> argument.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rush</span><span class="op">$</span><span class="fu">stop_workers</span><span class="op">(</span>worker_ids <span class="op">=</span> <span class="va">worker_ids</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
</div>
<p>This command terminates the selected worker process.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rush</span><span class="op">$</span><span class="va">worker_info</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       worker_id   pid remote      hostname heartbeat   state
          &lt;char&gt; &lt;int&gt; &lt;lgcl&gt;        &lt;char&gt;    &lt;lgcl&gt;  &lt;char&gt;
1: presentien...  8634  FALSE runnervmwf...     FALSE running
2: endangered...  8697  FALSE runnervmwf...     FALSE running
3: incredulou...  8699  FALSE runnervmwf...     FALSE running
4: roomy_clea...  8623  FALSE runnervmwf...     FALSE  killed</code></pre>
</div>
</div>
<p>To stop all workers and reset the network, the <code>$reset()</code> method is used.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rush</span><span class="op">$</span><span class="fu">reset</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<p>Instead of killing the worker processes, it is also possible to send a terminate signal to the worker. The worker then terminates after it has finished the current task. The worker loop must implement the <code>rush$terminated</code> flag. Then the rush controller can terminate the optimization.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wl_random_search</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">rush</span>, <span class="va">branin</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">while</span><span class="op">(</span><span class="op">!</span><span class="va">rush</span><span class="op">$</span><span class="va">terminated</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>    <span class="va">xs</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>x1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">5</span>, <span class="fl">10</span><span class="op">)</span>, x2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">15</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">key</span> <span class="op">=</span> <span class="va">rush</span><span class="op">$</span><span class="fu">push_running_tasks</span><span class="op">(</span>xss <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">xs</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">ys</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu">branin</span><span class="op">(</span><span class="va">xs</span><span class="op">$</span><span class="va">x1</span>, <span class="va">xs</span><span class="op">$</span><span class="va">x2</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">rush</span><span class="op">$</span><span class="fu">push_results</span><span class="op">(</span><span class="va">key</span>, yss <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">ys</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">rush</span> <span class="op">=</span> <span class="fu"><a href="../reference/rsh.html">rsh</a></span><span class="op">(</span></span>
<span>  network <span class="op">=</span> <span class="st">"test-random-search-terminate"</span>,</span>
<span>  config <span class="op">=</span> <span class="fu">redux</span><span class="fu">::</span><span class="fu"><a href="https://richfitz.github.io/redux/reference/redis_config.html" class="external-link">redis_config</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rush</span><span class="op">$</span><span class="fu">start_local_workers</span><span class="op">(</span></span>
<span>  worker_loop <span class="op">=</span> <span class="va">wl_random_search</span>,</span>
<span>  n_workers <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  branin <span class="op">=</span> <span class="va">branin</span><span class="op">)</span></span></code></pre></div>
</div>
<p>The random search proceeds as usual.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rush</span><span class="op">$</span><span class="fu">fetch_finished_tasks</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            x1        x2          y   pid     worker_id
         &lt;num&gt;     &lt;num&gt;      &lt;num&gt; &lt;int&gt;        &lt;char&gt;
  1:  3.889869  5.782428  19.112482  8772 fetid_rabb...
  2:  7.262342  4.223675  24.168217  8770 idiosyncra...
  3:  6.586416  7.091787  54.807999  8772 fetid_rabb...
  4: -2.972467  8.454350  12.216892  8772 fetid_rabb...
  5:  2.597244  8.898633  39.741652  8772 fetid_rabb...
 ---
626:  5.006908 12.160945 131.404313  8770 idiosyncra...
627: -2.803401 11.438668   0.943257  8772 fetid_rabb...
628: -2.621570  8.371478   8.896414  8770 idiosyncra...
629:  8.090129  2.114706   8.040149  8772 fetid_rabb...
630: -1.851024 10.466015   8.505084  8770 idiosyncra...
                                     keys
                                   &lt;list&gt;
  1: 523c019c-351d-416a-b54f-6d285cc92d92
  2: 7bc9ea0e-ac87-492c-b34e-ec47b1f1ee99
  3: 8bfe6274-4f7c-4d2a-bcff-2101731fc4b1
  4: 4f542dd9-1651-467b-8de7-81552381e678
  5: 51ff82b5-e58d-4b1f-9a26-ea2d8978088a
 ---
626: b2b0558c-979f-4c9a-8e41-f0b95aaed964
627: 49022e9d-0239-4be4-9f90-30efa9e0c177
628: a592fea1-ae70-42ff-8945-ea0091ca4e90
629: 525e06db-d631-43ed-b873-d88e738c206d
630: a7c60855-b68d-4aae-8255-871fb3dd01c2</code></pre>
</div>
</div>
<p>To terminate the optimization, the following command is used.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rush</span><span class="op">$</span><span class="fu">stop_workers</span><span class="op">(</span>type <span class="op">=</span> <span class="st">"terminate"</span><span class="op">)</span></span></code></pre></div>
</div>
<p>The workers are terminated.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rush</span><span class="op">$</span><span class="va">worker_info</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       worker_id   pid remote      hostname heartbeat      state
          &lt;char&gt; &lt;int&gt; &lt;lgcl&gt;        &lt;char&gt;    &lt;lgcl&gt;     &lt;char&gt;
1: idiosyncra...  8770  FALSE runnervmwf...     FALSE terminated
2: fetid_rabb...  8772  FALSE runnervmwf...     FALSE terminated</code></pre>
</div>
</div>
</section><section class="level2"><h3 id="sec-local-failed-workers">Failed Workers<a class="anchor" aria-label="anchor" href="#sec-local-failed-workers"></a>
</h3>
<p>We simulate a segfault on the worker by killing the worker process.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rush</span> <span class="op">=</span> <span class="fu"><a href="../reference/rsh.html">rsh</a></span><span class="op">(</span>network <span class="op">=</span> <span class="st">"test-failed-workers"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">wl_failed_worker</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">rush</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">tools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/tools/pskill.html" class="external-link">pskill</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.getpid.html" class="external-link">Sys.getpid</a></span><span class="op">(</span><span class="op">)</span>, <span class="fu">tools</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/r/tools/pskill.html" class="external-link">SIGKILL</a></span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<p>Workers are then started using the faulty worker loop.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">worker_ids</span> <span class="op">=</span>  <span class="va">rush</span><span class="op">$</span><span class="fu">start_local_workers</span><span class="op">(</span></span>
<span>  worker_loop <span class="op">=</span> <span class="va">wl_failed_worker</span>,</span>
<span>  n_workers <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
</div>
<p>The <code>$detect_lost_workers()</code> method is used to identify failed workers. When a worker is detected, its state is updated to <code>"lost"</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rush</span><span class="op">$</span><span class="fu">detect_lost_workers</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">rush</span><span class="op">$</span><span class="va">worker_info</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       worker_id   pid remote      hostname heartbeat  state
          &lt;char&gt; &lt;int&gt; &lt;lgcl&gt;        &lt;char&gt;    &lt;lgcl&gt; &lt;char&gt;
1: underprivi...  8846  FALSE runnervmwf...     FALSE   lost
2: paleologic...  8848  FALSE runnervmwf...     FALSE   lost</code></pre>
</div>
</div>
</section><section class="level2"><h3 id="sec-local-restart-workers">Restart Workers<a class="anchor" aria-label="anchor" href="#sec-local-restart-workers"></a>
</h3>
<p>Workers that have failed can be restarted using the <code>$restart_workers()</code> method. This method accepts the <code>worker_ids</code> of the workers to be restarted.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rush</span><span class="op">$</span><span class="fu">restart_workers</span><span class="op">(</span>worker_ids <span class="op">=</span> <span class="va">worker_ids</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
</div>
<p>The first worker is restarted and its state is updated to <code>"running"</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rush</span><span class="op">$</span><span class="va">worker_info</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       worker_id   pid remote      hostname heartbeat   state
          &lt;char&gt; &lt;int&gt; &lt;lgcl&gt;        &lt;char&gt;    &lt;lgcl&gt;  &lt;char&gt;
1: underprivi...  8918  FALSE runnervmwf...     FALSE running
2: paleologic...  8848  FALSE runnervmwf...     FALSE    lost</code></pre>
</div>
</div>
</section><section class="level2"><h3 id="sec-local-log-messages">Log Messages<a class="anchor" aria-label="anchor" href="#sec-local-log-messages"></a>
</h3>
<p>Workers record all messages generated using the <code>lgr</code> package to the database. The <code>lgr_thresholds</code> argument of <code>$start_local_workers()</code> specifies the logging level for each logger, e.g. <code>c("mlr3/rush" = "debug")</code>. While enabling log message storage introduces a minor performance overhead, it is valuable for debugging purposes. By default, log messages are not stored. To enable logging, workers are started with the desired logging threshold.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rush</span> <span class="op">=</span> <span class="fu"><a href="../reference/rsh.html">rsh</a></span><span class="op">(</span>network <span class="op">=</span> <span class="st">"test-log-messages"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">wl_log_message</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">rush</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">lg</span> <span class="op">=</span> <span class="fu">lgr</span><span class="fu">::</span><span class="fu"><a href="https://s-fleck.github.io/lgr/reference/get_logger.html" class="external-link">get_logger</a></span><span class="op">(</span><span class="st">"mlr3/rush"</span><span class="op">)</span></span>
<span>  <span class="va">lg</span><span class="op">$</span><span class="fu">info</span><span class="op">(</span><span class="st">"This is an info message from worker %s"</span>, <span class="va">rush</span><span class="op">$</span><span class="va">worker_id</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">rush</span><span class="op">$</span><span class="fu">start_local_workers</span><span class="op">(</span></span>
<span>  worker_loop <span class="op">=</span> <span class="va">wl_log_message</span>,</span>
<span>  n_workers <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  lgr_thresholds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>rush <span class="op">=</span> <span class="st">"info"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<p>The most recent log messages can be printed as follows.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Sys.sleep.html" class="external-link">Sys.sleep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">rush</span><span class="op">$</span><span class="fu">print_log</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<p>To retrieve all log entries, use the <code>$read_log()</code> method.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rush</span><span class="op">$</span><span class="fu">read_log</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Null data.table (0 rows and 0 cols)</code></pre>
</div>
</div>
<p>We reset the network.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rush</span><span class="op">$</span><span class="fu">reset</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
</section></section><section class="section level2"><h2 id="sec-remote-workers">Remote Workers<a class="anchor" aria-label="anchor" href="#sec-remote-workers"></a>
</h2>
<p>The <code>mirai</code> package provides a straightforward mechanism for launching <code>rush</code> workers on remote machines. <code>mirai</code> manages daemons, which are persistent background processes capable of executing arbitrary R code in parallel. These daemons communicate with the main session.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mirai.r-lib.org" class="external-link">mirai</a></span><span class="op">)</span></span></code></pre></div>
</div>
<section class="level2"><h3 id="sec-remote-start-workers">Start Workers<a class="anchor" aria-label="anchor" href="#sec-remote-start-workers"></a>
</h3>
<p>Usually <code>mirai</code> is used to start daemons on remote machines but it can also be used to start local daemons.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://mirai.r-lib.org/reference/daemons.html" class="external-link">daemons</a></span><span class="op">(</span></span>
<span>  n <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  url <span class="op">=</span> <span class="fu"><a href="https://mirai.r-lib.org/reference/host_url.html" class="external-link">host_url</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<p>Daemons may also be launched on a remote machine via SSH.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://mirai.r-lib.org/reference/daemons.html" class="external-link">daemons</a></span><span class="op">(</span></span>
<span>  n <span class="op">=</span> <span class="fl">2L</span>,</span>
<span>  url <span class="op">=</span> <span class="fu"><a href="https://mirai.r-lib.org/reference/host_url.html" class="external-link">host_url</a></span><span class="op">(</span>port <span class="op">=</span> <span class="fl">5555</span><span class="op">)</span>,</span>
<span>  remote <span class="op">=</span> <span class="fu"><a href="https://mirai.r-lib.org/reference/ssh_config.html" class="external-link">ssh_config</a></span><span class="op">(</span>remotes <span class="op">=</span> <span class="st">"ssh://10.75.32.90"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<p>On high performance computing clusters, daemons can be started using a scheduler.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://mirai.r-lib.org/reference/daemons.html" class="external-link">daemons</a></span><span class="op">(</span></span>
<span>  n <span class="op">=</span> <span class="fl">2L</span>,</span>
<span>  url <span class="op">=</span> <span class="fu"><a href="https://mirai.r-lib.org/reference/host_url.html" class="external-link">host_url</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  remote <span class="op">=</span> <span class="fu"><a href="https://mirai.r-lib.org/reference/remote_config.html" class="external-link">remote_config</a></span><span class="op">(</span></span>
<span>    command <span class="op">=</span> <span class="st">"sbatch"</span>,</span>
<span>    args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"--mem 512"</span>, <span class="st">"-n 1"</span>, <span class="st">"--wrap"</span>, <span class="st">"."</span><span class="op">)</span>,</span>
<span>    rscript <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Rhome.html" class="external-link">R.home</a></span><span class="op">(</span><span class="st">"bin"</span><span class="op">)</span>, <span class="st">"Rscript"</span><span class="op">)</span>,</span>
<span>    quote <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<p>We define a worker loop.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wl_random_search</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">rush</span>, <span class="va">branin</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">while</span><span class="op">(</span><span class="cn">TRUE</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>    <span class="va">xs</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>x1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">5</span>, <span class="fl">10</span><span class="op">)</span>, x2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">15</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">key</span> <span class="op">=</span> <span class="va">rush</span><span class="op">$</span><span class="fu">push_running_tasks</span><span class="op">(</span>xss <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">xs</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">ys</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu">branin</span><span class="op">(</span><span class="va">xs</span><span class="op">$</span><span class="va">x1</span>, <span class="va">xs</span><span class="op">$</span><span class="va">x2</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">rush</span><span class="op">$</span><span class="fu">push_results</span><span class="op">(</span><span class="va">key</span>, yss <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">ys</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">rush</span> <span class="op">=</span> <span class="fu"><a href="../reference/rsh.html">rsh</a></span><span class="op">(</span></span>
<span>  network <span class="op">=</span> <span class="st">"test-network"</span>,</span>
<span>  config <span class="op">=</span> <span class="fu">redux</span><span class="fu">::</span><span class="fu"><a href="https://richfitz.github.io/redux/reference/redis_config.html" class="external-link">redis_config</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<p>We start two new daemons.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://mirai.r-lib.org/reference/daemons.html" class="external-link">daemons</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
</div>
<p>After the daemons are started, we can start the remote workers.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">worker_ids</span> <span class="op">=</span> <span class="va">rush</span><span class="op">$</span><span class="fu">start_remote_workers</span><span class="op">(</span></span>
<span>  worker_loop <span class="op">=</span> <span class="va">wl_random_search</span>,</span>
<span>  n_workers <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  branin <span class="op">=</span> <span class="va">branin</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rush</span><span class="op">$</span><span class="va">worker_info</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       worker_id   pid remote      hostname heartbeat   state
          &lt;char&gt; &lt;int&gt; &lt;lgcl&gt;        &lt;char&gt;    &lt;lgcl&gt;  &lt;char&gt;
1: microphysi...  9070   TRUE runnervmwf...     FALSE running
2: craven_hoo...  9072   TRUE runnervmwf...     FALSE running</code></pre>
</div>
</div>
<p>We stop the daemons.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rush</span><span class="op">$</span><span class="fu">reset</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
</section><section class="level2"><h3 id="sec-remote-failed-workers">Failed Workers<a class="anchor" aria-label="anchor" href="#sec-remote-failed-workers"></a>
</h3>
<p>Failed workers started with <code>mirai</code> are also detected by the controller. We simulate a segfault on the worker by killing the worker process.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rush</span> <span class="op">=</span> <span class="fu"><a href="../reference/rsh.html">rsh</a></span><span class="op">(</span>network <span class="op">=</span> <span class="st">"test-failed-mirai-workers"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">wl_failed_worker</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">rush</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">tools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/tools/pskill.html" class="external-link">pskill</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.getpid.html" class="external-link">Sys.getpid</a></span><span class="op">(</span><span class="op">)</span>, <span class="fu">tools</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/r/tools/pskill.html" class="external-link">SIGKILL</a></span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<p>Start two new daemons.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://mirai.r-lib.org/reference/daemons.html" class="external-link">daemons</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
</div>
<p>Start two remote workers.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">worker_ids</span> <span class="op">=</span> <span class="va">rush</span><span class="op">$</span><span class="fu">start_remote_workers</span><span class="op">(</span></span>
<span>  worker_loop <span class="op">=</span> <span class="va">wl_failed_worker</span>,</span>
<span>  n_workers <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rush</span><span class="op">$</span><span class="fu">detect_lost_workers</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<p>A segmentation fault also terminates the associated <code>mirai</code> daemon. Therefore, it is necessary to restart the daemon before restarting the workers.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://mirai.r-lib.org/reference/daemons.html" class="external-link">daemons</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
</div>
<p>Workers can then be restarted using the <code>$restart_workers()</code> method.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rush</span><span class="op">$</span><span class="fu">restart_workers</span><span class="op">(</span><span class="va">worker_ids</span><span class="op">)</span></span></code></pre></div>
</div>
</section></section><section class="section level2"><h2 id="sec-script-workers">Script Workers<a class="anchor" aria-label="anchor" href="#sec-script-workers"></a>
</h2>
<p>The most flexible method for starting workers is to use a script generated with the <code>$worker_script()</code> method. This script can be executed either on the local machine or on a remote machine. The only requirement is that the machine is capable of running R scripts and has access to the Redis database.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rush</span> <span class="op">=</span> <span class="fu"><a href="../reference/rsh.html">rsh</a></span><span class="op">(</span></span>
<span>  network <span class="op">=</span> <span class="st">"test-script-workers"</span>,</span>
<span>  config <span class="op">=</span> <span class="fu">redux</span><span class="fu">::</span><span class="fu"><a href="https://richfitz.github.io/redux/reference/redis_config.html" class="external-link">redis_config</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rush</span><span class="op">$</span><span class="fu">worker_script</span><span class="op">(</span></span>
<span>  worker_loop <span class="op">=</span> <span class="va">wl_random_search</span><span class="op">)</span></span></code></pre></div>
</div>
<section class="level2"><h3 id="sec-script-error-handling">Error Handling<a class="anchor" aria-label="anchor" href="#sec-script-error-handling"></a>
</h3>
<p>Workers started with <code>processx</code> or <code>mirai</code> are monitored by these packages. The heartbeat is a mechanism to monitor the status of script workers. The mechanism consists of a heartbeat key with a set <a href="https://redis.io/commands/expire/" class="external-link">expiration timeout</a> and a dedicated heartbeat process that refreshes the timeout periodically. The heartbeat process is started with <code>callr</code> and is linked to the main process of the worker. In the event of a worker’s failure, the associated heartbeat process also ceases to function, thus halting the renewal of the timeout. The absence of the heartbeat key acts as an indicator to the controller that the worker is no longer operational. Consequently, the controller updates the worker’s status to <code>"lost"</code>.</p>
<p>Heartbeats are initiated upon worker startup by specifying the <code>heartbeat_period</code> and <code>heartbeat_expire</code> parameters. The <code>heartbeat_period</code> defines the frequency at which the heartbeat process will update the timeout. The <code>heartbeat_expire</code> sets the duration, in seconds, before the heartbeat key expires. The expiration time should be set to a value greater than the heartbeat period to ensure that the heartbeat process has sufficient time to refresh the timeout.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rush</span><span class="op">$</span><span class="fu">worker_script</span><span class="op">(</span></span>
<span>  worker_loop <span class="op">=</span> <span class="va">wl_random_search</span>,</span>
<span>  heartbeat_period <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  heartbeat_expire <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
</div>
<p>The heartbeat process is also the only way to kill a script worker. The <code>$stop_workers(type = "kill")</code> method pushes a kill signal to the heartbeat process. The heartbeat process terminates the main process of the worker.</p>
</section></section><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config);
    }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script></main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Marc Becker.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
